<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mission Control | Kanban</title>
  <link rel="stylesheet" href="css/styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <img src="assets/randy-2.jpg" alt="Randy" class="logo-icon randy-avatar">
          <span class="logo-text">Mission Control</span>
        </div>
        <button class="sidebar-toggle" id="sidebarToggle">
          <span></span><span></span><span></span>
        </button>
      </div>
      
      <nav class="sidebar-nav">
        <a href="#" class="nav-item active" data-view="kanban">
          <span class="nav-icon">üìã</span>
          <span class="nav-text">Kanban</span>
        </a>
        <a href="#" class="nav-item" data-view="dashboard">
          <span class="nav-icon">üìä</span>
          <span class="nav-text">Dashboard</span>
        </a>
        <a href="#" class="nav-item" data-view="activity">
          <span class="nav-icon">üïê</span>
          <span class="nav-text">Activity Feed</span>
        </a>
        <a href="#" class="nav-item" data-view="randy">
          <img src="assets/randy-3.jpg" alt="Randy" class="nav-icon randy-nav-avatar">
          <span class="nav-text">Tarefas do Randy</span>
          <span class="badge" id="randyBadge">0</span>
        </a>
      </nav>

      <div class="sidebar-section">
        <h3>Projetos</h3>
        <div id="projectsList" class="projects-list">
          <!-- Projetos ser√£o carregados aqui -->
        </div>
        <button class="btn-add-project" id="btnAddProject">
          <span>+</span> Novo Projeto
        </button>
      </div>

      <div class="sidebar-section sidebar-fridge">
        <h3>‚ùÑÔ∏è Geladeira</h3>
        <div id="fridgeProjectsList" class="projects-list">
          <!-- Projetos em geladeira ser√£o carregados aqui -->
        </div>
      </div>

      <div class="sidebar-footer">
        <div class="user-info">
          <img src="assets/randy-1.jpg" alt="Randy" class="user-avatar randy-user-avatar">
          <span class="user-name">Randy</span>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <div class="header-left">
          <h1 id="pageTitle">Kanban Board</h1>
          <div class="status-indicator" id="statusIndicator">
            <span class="status-dot" id="statusDot"></span>
            <span class="status-text" id="statusText">Randy Online</span>
          </div>
          <div class="sync-controls" id="syncControls">
            <button class="btn-sync" id="btnSync" title="Sync with Randy">
              <span class="sync-icon" id="syncIcon">üîÑ</span>
              <span class="sync-label">Sync with Randy</span>
            </button>
            <div class="sync-status" id="syncStatus">
              <span class="sync-status-dot" id="syncStatusDot"></span>
              <span class="sync-status-text" id="syncStatusText">Checking...</span>
            </div>
            <span class="sync-timestamp" id="syncTimestamp"></span>
          </div>
          <span class="header-subtitle" id="headerSubtitle"></span>
        </div>
        <div class="header-right">
          <button class="btn-global-search" id="btnGlobalSearch" title="Global Search (Ctrl+K)">
            <span class="search-icon">üîç</span>
            <span class="search-label">Search...</span>
            <kbd class="search-kbd">‚åòK</kbd>
          </button>
          <div class="search-box">
            <input type="text" id="searchInput" placeholder="Filtrar tarefas...">
            <span class="search-icon">üîç</span>
          </div>
          <button class="btn-filter" id="btnFilter">
            <span>‚öôÔ∏è</span> Filtros
          </button>
          <button class="btn-primary" id="btnNewTask">
            <span>+</span> Nova Tarefa
          </button>
        </div>
      </header>

      <!-- Filters Bar -->
      <div class="filters-bar" id="filtersBar">
        <div class="filter-group">
          <label>Prioridade:</label>
          <select id="filterPriority">
            <option value="">Todas</option>
            <option value="urgent">Urgente</option>
            <option value="high">Alta</option>
            <option value="medium">M√©dia</option>
            <option value="low">Baixa</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Projeto:</label>
          <select id="filterProject">
            <option value="">Todos</option>
          </select>
        </div>
        <div class="filter-group">
          <label>Atribu√≠do:</label>
          <select id="filterAssignee">
            <option value="">Todos</option>
            <option value="randy">Randy</option>
            <option value="ruben">Ruben</option>
            <option value="unassigned">N√£o atribu√≠do</option>
          </select>
        </div>
        <button class="btn-clear-filters" id="btnClearFilters">Limpar</button>
      </div>

      <!-- Views -->
      <div class="views-container">
        <!-- Kanban View -->
        <div class="view view-kanban active" id="kanbanView">
          <div class="kanban-board" id="kanbanBoard">
            <div class="kanban-column column-backlog" data-status="backlog">
              <div class="column-header">
                <h3>
                  <span class="column-dot" style="background: #94a3b8;"></span>
                  Backlog
                </h3>
                <span class="column-count">0</span>
              </div>
              <div class="column-content" id="col-backlog">
                <!-- Cards aqui -->
              </div>
              <button class="btn-add-card" data-column="backlog">+ Adicionar</button>
            </div>

            <div class="kanban-column column-todo" data-status="todo">
              <div class="column-header">
                <h3>
                  <span class="column-dot" style="background: #3b82f6;"></span>
                  To Do
                </h3>
                <span class="column-count">0</span>
              </div>
              <div class="column-content" id="col-todo">
                <!-- Cards aqui -->
              </div>
              <button class="btn-add-card" data-column="todo">+ Adicionar</button>
            </div>

            <div class="kanban-column column-in-progress" data-status="in_progress">
              <div class="column-header">
                <h3>
                  <span class="column-dot" style="background: #f59e0b;"></span>
                  In Progress
                </h3>
                <span class="column-count">0</span>
              </div>
              <div class="column-content" id="col-in_progress">
                <!-- Cards aqui -->
              </div>
              <button class="btn-add-card" data-column="in_progress">+ Adicionar</button>
            </div>

            <div class="kanban-column column-review" data-status="review">
              <div class="column-header">
                <h3>
                  <span class="column-dot" style="background: #fbbf24;"></span>
                  Review
                </h3>
                <span class="column-count">0</span>
              </div>
              <div class="column-content" id="col-review">
                <!-- Cards aqui -->
              </div>
              <button class="btn-add-card" data-column="review">+ Adicionar</button>
            </div>

            <div class="kanban-column column-done" data-status="done">
              <div class="column-header">
                <h3>
                  <span class="column-dot" style="background: #10b981;"></span>
                  Done
                </h3>
                <span class="column-count">0</span>
              </div>
              <div class="column-content" id="col-done">
                <!-- Cards aqui -->
              </div>
              <button class="btn-add-card" data-column="done">+ Adicionar</button>
            </div>
          </div>
        </div>

        <!-- Dashboard View -->
        <div class="view view-dashboard" id="dashboardView">
          <div class="dashboard-grid">
            <div class="metric-card">
              <div class="metric-icon">üìä</div>
              <div class="metric-info">
                <span class="metric-value" id="metricTotal">0</span>
                <span class="metric-label">Total de Tarefas</span>
              </div>
            </div>
            <div class="metric-card">
              <div class="metric-icon">‚úÖ</div>
              <div class="metric-info">
                <span class="metric-value" id="metricCompleted">0</span>
                <span class="metric-label">Conclu√≠das Hoje</span>
              </div>
            </div>
            <div class="metric-card">
              <div class="metric-icon">‚è±Ô∏è</div>
              <div class="metric-info">
                <span class="metric-value" id="metricAvgTime">0h</span>
                <span class="metric-label">Tempo M√©dio</span>
              </div>
            </div>
            <div class="metric-card">
              <div class="metric-icon">üìà</div>
              <div class="metric-info">
                <span class="metric-value" id="metricRate">0%</span>
                <span class="metric-label">Taxa de Conclus√£o</span>
              </div>
            </div>
          </div>

          <div class="dashboard-charts">
            <div class="chart-container">
              <h3>Por Status</h3>
              <div class="chart" id="statusChart"></div>
            </div>
            <div class="chart-container">
              <h3>Por Prioridade</h3>
              <div class="chart" id="priorityChart"></div>
            </div>
          </div>

          <div class="activity-feed">
            <h3>Atividades Recentes</h3>
            <div id="activityList" class="activity-list">
              <!-- Atividades ser√£o carregadas aqui -->
            </div>
          </div>
        </div>

        <!-- Activity Feed View -->
        <div class="view view-activity" id="activityView">
          <div class="activity-feed-page">
            <div class="activity-feed-header">
              <h3>üïê Activity Feed</h3>
              <button class="btn-secondary" id="btnRefreshActivity">üîÑ Refresh</button>
            </div>
            <div class="activity-feed-list" id="activityFeedList">
              <div class="empty">Loading activities...</div>
            </div>
            <div class="activity-feed-footer">
              <button class="btn-secondary" id="btnLoadMoreActivity">Load More</button>
            </div>
          </div>
        </div>

        <!-- Randy View -->
        <div class="view view-randy" id="randyView">
          <div class="randy-header">
            <div class="randy-stats">
              <div class="randy-stat">
                <span class="stat-value" id="randyTotal">0</span>
                <span class="stat-label">Total</span>
              </div>
              <div class="randy-stat">
                <span class="stat-value" id="randyInProgress">0</span>
                <span class="stat-label">Em Progresso</span>
              </div>
              <div class="randy-stat">
                <span class="stat-value" id="randyDone">0</span>
                <span class="stat-label">Conclu√≠das</span>
              </div>
            </div>
            <div class="randy-current" id="randyCurrentTask"></div>
          </div>
          <div class="randy-tasks" id="randyTasks">
            <!-- Tarefas do Randy -->
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal de Tarefa -->
  <div class="modal" id="taskModal">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modalTitle">Nova Tarefa</h2>
        <button class="modal-close" id="modalClose">√ó</button>
      </div>
      <div class="modal-body">
        <div class="quick-add">
          <label for="taskQuickTitle">Quick add (Enter para Backlog)</label>
          <div class="quick-add-row">
            <input type="text" id="taskQuickTitle" placeholder="T√≠tulo r√°pido da tarefa">
            <button type="button" class="btn-secondary" id="btnQuickAdd">Adicionar</button>
          </div>
        </div>

        <div class="template-row">
          <label for="templateSelect">Templates</label>
          <div class="template-controls">
            <select id="templateSelect"></select>
            <button type="button" class="btn-secondary" id="btnSaveTemplate">Salvar template</button>
            <button type="button" class="btn-secondary" id="btnManageTemplates">Gerenciar templates</button>
          </div>
        </div>

        <form id="taskForm">
          <input type="hidden" id="taskId">
          
          <div class="form-group">
            <label for="taskTitle">T√≠tulo *</label>
            <input type="text" id="taskTitle" required placeholder="Nome da tarefa">
          </div>

          <div class="form-group">
            <label for="taskDescription">Descri√ß√£o</label>
            <textarea id="taskDescription" rows="3" placeholder="Descri√ß√£o detalhada..."></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="taskStatus">Status</label>
              <select id="taskStatus">
                <option value="backlog">Backlog</option>
                <option value="todo">To Do</option>
                <option value="in_progress">In Progress</option>
                <option value="review">Review</option>
                <option value="done">Done</option>
              </select>
            </div>

            <div class="form-group">
              <label for="taskPriority">Prioridade</label>
              <div class="select-with-indicator">
                <span class="priority-indicator" id="taskPriorityIndicator"></span>
                <select id="taskPriority">
                  <option value="urgent">Urgente</option>
                  <option value="high">Alta</option>
                  <option value="medium">M√©dia</option>
                  <option value="low">Baixa</option>
                </select>
              </div>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="taskProject">Projeto</label>
              <select id="taskProject">
                <!-- Projetos ser√£o carregados -->
              </select>
            </div>

            <div class="form-group">
              <label for="taskAssignee">Atribu√≠do a</label>
              <select id="taskAssignee">
                <option value="">N√£o atribu√≠do</option>
                <option value="randy">Randy ü§ñ</option>
                <option value="ruben">Ruben</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label for="taskTags">Tags (separadas por v√≠rgula)</label>
            <input type="text" id="taskTags" placeholder="bug, feature, urgent">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="taskDueDate">Data de entrega</label>
              <input type="date" id="taskDueDate">
            </div>

            <div class="form-group notion-group">
              <div class="notion-label-row">
                <label for="notionSearchInput">Notion</label>
                <span class="notion-badge" id="notionBadge" hidden>Notion Online</span>
              </div>
              <div class="notion-search">
                <input type="text" id="notionSearchInput" placeholder="Buscar p√°ginas no Notion...">
                <button type="button" class="btn-secondary notion-clear" id="notionClear">Limpar</button>
              </div>
              <div class="notion-selected" id="notionSelected"></div>
              <div class="notion-results" id="notionSearchResults"></div>
              <div class="notion-status" id="notionStatus"></div>
              <input type="hidden" id="taskNotionId">
              <input type="hidden" id="taskNotionUrl">
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="taskEstimated">Horas Estimadas</label>
              <input type="number" id="taskEstimated" min="0" step="0.5">
            </div>

            <div class="form-group">
              <label for="taskActual">Horas Reais</label>
              <input type="number" id="taskActual" min="0" step="0.5">
            </div>
          </div>

          <div class="form-group">
            <label for="taskRandyStatus">Status Randy</label>
            <select id="taskRandyStatus">
              <option value="pending">Pending</option>
              <option value="in-progress">In Progress</option>
              <option value="completed">Completed</option>
              <option value="failed">Failed</option>
            </select>
          </div>
        </form>

        <!-- Se√ß√£o de Coment√°rios -->
        <div class="comments-section" id="commentsSection" style="display: none;">
          <h3>Coment√°rios</h3>
          <div class="comments-list" id="commentsList"></div>
          <div class="comment-form">
            <input type="text" id="newComment" placeholder="Adicionar coment√°rio...">
            <button id="btnAddComment">Enviar</button>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="btnCancel">Cancelar</button>
        <button type="button" class="btn-danger" id="btnDelete" style="display: none;">Excluir</button>
        <button type="submit" class="btn-primary" id="btnSave">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Projeto -->
  <div class="modal" id="projectModal">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2>Novo Projeto</h2>
        <button class="modal-close" id="projectModalClose">√ó</button>
      </div>
      <div class="modal-body">
        <form id="projectForm">
          <div class="form-group">
            <label for="projectName">Nome *</label>
            <input type="text" id="projectName" required>
          </div>
          <div class="form-group">
            <label for="projectDescription">Descri√ß√£o</label>
            <textarea id="projectDescription" rows="2"></textarea>
          </div>
          <div class="form-group">
            <label for="projectColor">Cor</label>
            <input type="color" id="projectColor" value="#6366f1">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="btnCancelProject">Cancelar</button>
        <button type="submit" class="btn-primary" id="btnSaveProject">Salvar</button>
      </div>
    </div>
  </div>

  <!-- Modal de Templates -->
  <div class="modal" id="templatesModal">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2>Templates Salvos</h2>
        <button class="modal-close" id="templatesModalClose">√ó</button>
      </div>
      <div class="modal-body">
        <div class="template-manager-list" id="templateManagerList"></div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="btnCloseTemplates">Fechar</button>
      </div>
    </div>
  </div>

  <!-- Global Search Modal -->
  <div class="global-search-overlay" id="globalSearchOverlay">
    <div class="global-search-modal">
      <div class="global-search-input-wrap">
        <span class="global-search-icon">üîç</span>
        <input type="text" id="globalSearchInput" placeholder="Search tasks, memory, documents..." autocomplete="off" spellcheck="false">
        <kbd class="global-search-esc">ESC</kbd>
      </div>
      <div class="global-search-results" id="globalSearchResults">
        <div class="global-search-empty">Type to search across everything...</div>
      </div>
    </div>
  </div>

  <!-- Document Preview Modal -->
  <div class="modal" id="docPreviewModal">
    <div class="modal-overlay"></div>
    <div class="modal-content modal-doc-preview">
      <div class="modal-header">
        <h2 id="docPreviewTitle">Document</h2>
        <button class="modal-close" id="docPreviewClose">√ó</button>
      </div>
      <div class="modal-body">
        <pre class="doc-preview-content" id="docPreviewContent"></pre>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div class="toast-container" id="toastContainer"></div>

  <script src="js/api.js"></script>
  <script src="js/modal.js"></script>
  <script src="js/kanban.js"></script>
  <script src="js/search.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
